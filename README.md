# Weather Infra Demo

Небольшой демонстрационный проект, показывающий базовый подход к эксплуатации сервиса:
Docker, конфигурация через environment variables, мониторинг и проверка доступности.

Проект выполнен как учебный pet-проект с упором на инженерную корректность, а не на бизнес-логику.

---

## Что реализовано

- HTTP-сервис на Go
- Конфигурация через переменные окружения
- Получение текущей погоды из внешнего API (без ключей)
- In-memory кэш с TTL
- Structured logging
- Prometheus-метрики приложения
- HTTP-проверка доступности через Blackbox Exporter
- Grafana с готовым dashboard
- Контейнеризация (multi-stage Dockerfile, non-root user)
- Запуск всего окружения одной командой

---

## Архитектура

Проект состоит из нескольких сервисов, запускаемых через `docker-compose`:

- **weather-service** — основной Go-сервис
- **prometheus** — сбор метрик приложения и результатов HTTP-проверок
- **blackbox-exporter** — проверка доступности `/health`
- **grafana** — визуализация метрик и состояния сервиса

Все сервисы работают в одной docker-сети и связаны по именам сервисов.

---

## Быстрый старт

Требования:

- Docker
- Docker Compose

Запуск всего окружения:

```
make docker-up
```

После запуска будут доступны:

- Weather service: http://localhost:8080

- Prometheus: http://localhost:9090

- Grafana: http://localhost:3000
  (admin / admin)

Остановка:

```
make docker-down
```

---

## HTTP эндпоинты сервиса

- GET /health — проверка состояния сервиса

- GET /weather — текущая температура (JSON)

- GET /metrics — Prometheus-метрики

Пример ответа /weather:

```
{
  "temperature_c": 27.4,
  "updated_at": "2025-12-12T12:30:00Z"
}
```

## Мониторинг и наблюдаемость

### Метрики приложения

Сервис экспортирует Prometheus-метрики, включая:

- количество HTTP-запросов

- latency обработки запросов

### Проверка доступности

Blackbox Exporter выполняет HTTP-проверку эндпоинта /health.
Результат доступен в Prometheus через метрику:

```
probe_success
```

### Grafana

В Grafana автоматически подгружается dashboard с:

- состоянием доступности сервиса

- RPS

- latency (p95)

## Примечания

Контейнер приложения запускается от non-root пользователя

Все параметры сервиса задаются через environment variables
